<!DOCTYPE html>
<html lang="kk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–ê—Ä“õ–∞–Ω –¢–∞—Ä—Ç—ã—Å ‚Äî –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤—Ç—ñ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞</title>
<style>
:root{
  --bg:#fff9ec;
  --red:#d42f2f;
  --blue:#1366d6;
  --orange:#f28500;
  --panel: rgba(255,255,255,0.95);
  --shadow: rgba(0,0,0,0.15);
  --highlight:#fbe8a6;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Noto Sans', sans-serif;}
body{background:linear-gradient(180deg,#fff9ec,#fff5d4);padding:10px;}
.wrap{max-width:1200px;margin:auto;}
h1{text-align:center;margin-bottom:20px;color:#6b4b2a;font-size:32px;text-shadow:0 2px 4px rgba(0,0,0,0.1);}
.board{display:flex;justify-content:space-between;align-items:center;gap:20px;flex-wrap:wrap;}
.team{width:45%;background:var(--panel);padding:15px;border-radius:15px;box-shadow:0 5px 15px var(--shadow);transition:transform 0.3s;}
.team:hover{transform:scale(1.02);}
.team h2{text-align:center;margin-bottom:10px;font-size:24px;color:#6b4b2a;}
.score{font-size:40px;font-weight:bold;text-align:center;margin-bottom:10px;color:#333;}
.progress-container{background:#eee;height:20px;border-radius:10px;overflow:hidden;margin-bottom:10px;}
.progress{height:100%;width:0%;border-radius:10px;transition: width 0.5s ease, background 0.5s ease;}
.calculator{display:flex;justify-content:center;gap:5px;margin-bottom:10px;}
.calculator input{width:60px;padding:8px;font-size:18px;text-align:center;border-radius:8px;border:1px solid #ccc;transition:0.3s;}
.calculator input:focus{border-color:var(--orange);outline:none;box-shadow:0 0 5px var(--orange);}
.calculator button{padding:8px 12px;font-size:16px;border-radius:8px;border:none;background:var(--orange);color:#fff;cursor:pointer;transition: all 0.3s;}
.calculator button:hover{opacity:0.8;transform:scale(1.05);}
.message{text-align:center;font-weight:bold;font-size:20px;height:24px;margin-bottom:10px;transition: all 0.5s ease;}
.rope-container{position:relative;height:180px;margin:30px 0;flex:1;display:flex;justify-content:center;align-items:center;}
.rope{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:250px;height:15px;background:var(--orange);border-radius:10px;transition: all 0.5s cubic-bezier(0.68,-0.55,0.27,1.55);}
.knot{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:40px;height:40px;background:#d89b49;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#fff;z-index:2;transition: all 0.5s cubic-bezier(0.68,-0.55,0.27,1.55);}
.players{position:absolute;top:50%;transform:translateY(-50%);}
.player{width:40px;height:40px;background:#ccc;border-radius:50%;display:inline-block;margin:0 5px;transition: all 0.5s cubic-bezier(0.68,-0.55,0.27,1.55);}
.player.red{background:var(--red);}
.player.blue{background:var(--blue);}
.timer{text-align:center;font-size:18px;margin-bottom:10px;color:#555;}
.history{max-height:150px;overflow:auto;background:#f9f1df;padding:8px;border-radius:8px;margin-top:10px;}
.history div{padding:4px 2px;border-bottom:1px solid #eee;font-size:14px;transition:all 0.3s;}
.confetti{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:999;}
@keyframes shake{
  0%{transform:translateX(0);}
  25%{transform:translateX(-8px);}
  50%{transform:translateX(8px);}
  75%{transform:translateX(-8px);}
  100%{transform:translateX(0);}
}
</style>
</head>
<body>
<div class="wrap">
  <h1>–ê—Ä“õ–∞–Ω –¢–∞—Ä—Ç—ã—Å ‚Äî –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞</h1>
  <div class="board">
    <!-- –°–∏–Ω—è—è –∫–æ–º–∞–Ω–¥–∞ -->
    <div class="team" id="team-blue">
      <h2>–ö”©–∫ –∫–æ–º–∞–Ω–¥–∞</h2>
      <div class="score" id="score-blue">0</div>
      <div class="progress-container"><div class="progress" id="progress-blue" style="background:var(--blue)"></div></div>
      <div class="timer" id="timer-blue">20</div>
      <div class="calculator">
        <input type="text" id="input-blue" placeholder="–ñ“Ø–∫—Ç–µ–ª—É–¥–µ">
        <button id="submit-blue">–ñ—ñ–±–µ—Ä—É</button>
      </div>
      <div class="message" id="msg-blue"></div>
      <div class="history" id="history-blue"></div>
    </div>

    <!-- –í–µ—Ä—ë–≤–∫–∞ —Å –∏–≥—Ä–æ–∫–∞–º–∏ -->
    <div class="rope-container">
      <div class="players" style="left:-70px;">
        <div class="player blue" id="blue1"></div>
        <div class="player blue" id="blue2"></div>
      </div>
      <div class="rope" id="rope"></div>
      <div class="knot" id="knot">üîó</div>
      <div class="players" style="right:-70px;">
        <div class="player red" id="red1"></div>
        <div class="player red" id="red2"></div>
      </div>
    </div>

    <!-- –ö—Ä–∞—Å–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ -->
    <div class="team" id="team-red">
      <h2>“ö—ã–∑—ã–ª –∫–æ–º–∞–Ω–¥–∞</h2>
      <div class="score" id="score-red">0</div>
      <div class="progress-container"><div class="progress" id="progress-red" style="background:var(--red)"></div></div>
      <div class="timer" id="timer-red">20</div>
      <div class="calculator">
        <input type="text" id="input-red" placeholder="–ñ“Ø–∫—Ç–µ–ª—É–¥–µ">
        <button id="submit-red">–ñ—ñ–±–µ—Ä—É</button>
      </div>
      <div class="message" id="msg-red"></div>
      <div class="history" id="history-red"></div>
    </div>
  </div>
</div>

<canvas id="confetti" class="confetti"></canvas>
<audio id="rope-sound" src="https://cdn.pixabay.com/download/audio/2021/10/26/audio_b5db3b9f8f.mp3?filename=correct-2-46133.mp3"></audio>
<audio id="wrong-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_2de7b6b2f8.mp3?filename=wrong-6053.mp3"></audio>

<script>
// ---------- State ----------
let state={blue:0,red:0,max:15};
let rope=document.getElementById('rope');
let knot=document.getElementById('knot');
let progressBlue=document.getElementById('progress-blue');
let progressRed=document.getElementById('progress-red');
let ropeSound=document.getElementById('rope-sound');
let wrongSound=document.getElementById('wrong-sound');
let timerBlueEl=document.getElementById('timer-blue');
let timerRedEl=document.getElementById('timer-red');
let intervalBlue=null, intervalRed=null;
let currentTaskBlue=null, currentTaskRed=null;
let historyBlueEl=document.getElementById('history-blue');
let historyRedEl=document.getElementById('history-red');

// ---------- Helper ----------
function updateRope(){
  let balance=(state.red-state.blue)/state.max; // -1..1
  let center=50+balance*30;
  rope.style.left=center+'%';
  knot.style.left=center+'%';
  progressBlue.style.width=(state.blue/state.max*100)+'%';
  progressRed.style.width=(state.red/state.max*100)+'%';
  document.getElementById('blue1').style.transform=`translateX(${balance*-30}px)`;
  document.getElementById('blue2').style.transform=`translateX(${balance*-30}px)`;
  document.getElementById('red1').style.transform=`translateX(${balance*30}px)`;
  document.getElementById('red2').style.transform=`translateX(${balance*30}px)`;
}

// ---------- Task Generator ----------
function genTask(){
  let a=Math.floor(Math.random()*50+10);
  let b=Math.floor(Math.random()*20+5);
  let op=['+','-','√ó','√∑'][Math.floor(Math.random()*4)];
  let q='',ans='';
  if(op=='+'){q=`${a}+${b}`;ans=a+b;}
  if(op=='-'){q=`${a}-${b}`;ans=a-b;}
  if(op=='√ó'){q=`${a}√ó${b}`;ans=a*b;}
  if(op=='√∑'){let val=a*b;q=`${val}√∑${a}`;ans=b;}
  return {q,ans:String(ans)};
}

// ---------- Timer ----------
function startTimer(team){
  let time=20;
  let el=team=='blue'?timerBlueEl:timerRedEl;
  let interval=team=='blue'?intervalBlue:intervalRed;
  if(interval) clearInterval(interval);
  interval=setInterval(()=>{
    time--;
    el.textContent=time;
    if(time<=0){
      clearInterval(interval);
      checkAnswer(team);
    }
  },1000);
  if(team=='blue') intervalBlue=interval; else intervalRed=interval;
}

// ---------- Check Answer ----------
function checkAnswer(team){
  let input=document.getElementById('input-'+team);
  let msg=document.getElementById('msg-'+team);
  let val=input.value.trim();
  let task=team=='blue'?currentTaskBlue:currentTaskRed;
  if(val===task.ans){
    state[team]+=1;
    ropeSound.currentTime=0; ropeSound.play();
    msg.textContent='–∂–∞—Ä–∞–π—Å—ã“£'; msg.style.color='green';
    msg.style.transform='scale(1.3)';
    setTimeout(()=>msg.style.transform='scale(1)',400);
    rope.animate([{transform:'translateX(0)'},{transform:`translateX(${team=='blue'? -15:15}px)`},{transform:'translateX(0)'}],{duration:400});
  } else {
    msg.textContent='“õ–∞—Ç–µ'; msg.style.color='red';
    wrongSound.currentTime=0; wrongSound.play();
    msg.style.animation='shake 0.4s';
    setTimeout(()=>msg.style.animation='',400);
  }
  updateRope();
  // History
  let histEl=team=='blue'?historyBlueEl:historyRedEl;
  let div=document.createElement('div');
  div.textContent=`${task.q} ‚Üí ${val} (${val===task.ans?'–î“±—Ä—ã—Å':'“ö–∞—Ç–µ'})`;
  histEl.prepend(div);
  // New task
  let newTask=genTask();
  if(team=='blue'){currentTaskBlue=newTask;document.getElementById('input-blue').placeholder=newTask.q;}
  else {currentTaskRed=newTask;document.getElementById('input-red').placeholder=newTask.q;}
  input.value='';
  startTimer(team);
  if(state[team]>=state.max) win(team);
}

// ---------- Buttons ----------
document.getElementById('submit-blue').onclick=()=>checkAnswer('blue');
document.getElementById('submit-red').onclick=()=>checkAnswer('red');

// ---------- Win & Confetti ----------
let confettiCanvas=document.getElementById('confetti');
let ctx=confettiCanvas.getContext('2d');
function win(team){
  alert((team=='blue'?'–ö”©–∫':'“ö—ã–∑—ã–ª')+' –∫–æ–º–∞–Ω–¥–∞ –∂–µ“£–¥—ñ!');
  launchConfetti();
}
function launchConfetti(){
  confettiCanvas.width=window.innerWidth;
  confettiCanvas.height=window.innerHeight;
  let pieces=[];
  for(let i=0;i<200;i++){
    pieces.push({x:Math.random()*confettiCanvas.width,y:Math.random()*confettiCanvas.height,dx:(Math.random()-0.5)*6,dy:2+Math.random()*4,r:5+Math.random()*5,color:Math.random()>0.5?'#d42f2f':'#1366d6'});
  }
  let t=0;
  let id=setInterval(()=>{
    ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
    pieces.forEach(p=>{p.x+=p.dx;p.y+=p.dy;ctx.beginPath();ctx.fillStyle=p.color;ctx.arc(p.x,p.y,p.r,0,2*Math.PI);ctx.fill();});
    t++; if(t>120){clearInterval(id);ctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);}
  },16);
}

// ---------- Init ----------
currentTaskBlue=genTask(); currentTaskRed=genTask();
document.getElementById('input-blue').placeholder=currentTaskBlue.q;
document.getElementById('input-red').placeholder=currentTaskRed.q;
startTimer('blue'); startTimer('red');
updateRope();
</script>
</body>
</html>
